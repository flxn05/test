<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Glowing Ball with Trail</title>
<style>
  html,body{
    height:100%;
    margin:0;
    background:#000;
    overflow:hidden;
  }
  .stage{
    position:relative;
    width:100vw;
    height:100vh;
    background:#000;
    overflow:hidden;
  }
  canvas{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
  }
  .ball{
    position:absolute;
    width:80px;
    height:80px;
    border-radius:50%;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    background: radial-gradient(circle at 35% 30%, #ff8080 0%, #ff0000 40%, #7a0000 100%);
    box-shadow:
      0 0 60px rgba(255,80,80,0.9),
      0 0 120px rgba(255,0,0,0.6),
      0 0 200px rgba(255,40,40,0.4);
    will-change: transform;
    z-index:1;
  }
  button{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    padding:12px 18px;
    border:none;
    border-radius:12px;
    background:#e00000;
    color:white;
    font-size:16px;
    box-shadow:0 0 20px rgba(255,0,0,0.6);
    z-index:2;
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <canvas id="trail"></canvas>
    <div id="ball" class="ball"></div>
    <button id="reqBtn">Sensor erlauben</button>
  </div>

<script>
(function(){
  const ball = document.getElementById('ball');
  const stage = document.getElementById('stage');
  const reqBtn = document.getElementById('reqBtn');
  const canvas = document.getElementById('trail');
  const ctx = canvas.getContext('2d');

  let width, height, radius = 40;
  function measure(){
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }
  measure(); window.addEventListener('resize', measure);

  let pos = { x: width/2, y: height/2 };
  let g = { x:0, y:0 };   
  let smoothG = { x:0, y:0 };

  let calib = { x:0, y:0 };

  const smoothing = 0.05;

  function drawTrail(x,y){
    ctx.fillStyle = "rgba(200,200,200,0.15)";
    ctx.beginPath();
    ctx.arc(x, y, 2.5, 0, Math.PI*2);
    ctx.fill();
    // Slight fade effect for trail
    ctx.fillStyle = "rgba(0,0,0,0.05)";
    ctx.fillRect(0,0,width,height);
  }

  function updateBall(){
    // Smooth sensors
    smoothG.x += (g.x - smoothG.x) * smoothing;
    smoothG.y += (g.y - smoothG.y) * smoothing;

    // Adjust with calibration
    const adjX = smoothG.x - calib.x;
    const adjY = smoothG.y - calib.y;

    pos.x = width/2 + adjX * 25;
    pos.y = height/2 + adjY * 25;

    // Clamp inside
    pos.x = Math.max(radius, Math.min(width-radius, pos.x));
    pos.y = Math.max(radius, Math.min(height-radius, pos.y));

    ball.style.left = pos.x+"px";
    ball.style.top = pos.y+"px";

    // Draw trail
    drawTrail(pos.x, pos.y);

    requestAnimationFrame(updateBall);
  }
  requestAnimationFrame(updateBall);

  function handleMotion(e){
    const a = e.accelerationIncludingGravity;
    if (a){
      g.x = a.x || 0;
      g.y = -(a.y || 0);
    }
  }
  function handleOrientation(e){
    const beta = e.beta || 0;
    const gamma = e.gamma || 0;
    g.x = Math.sin(gamma * Math.PI/180) * 9.81;
    g.y = -Math.sin(beta * Math.PI/180) * 9.81;
  }

  async function requestPermission(){
    // Fullscreen
    if (stage.requestFullscreen) stage.requestFullscreen();
    // Try to lock orientation
    if (screen.orientation && screen.orientation.lock) {
      try { await screen.orientation.lock("portrait"); } catch(e){ console.warn(e); }
    }

    if (typeof DeviceMotionEvent !== "undefined" &&
        typeof DeviceMotionEvent.requestPermission === "function"){
      try{
        const res = await DeviceMotionEvent.requestPermission();
        if (res === "granted"){
          window.addEventListener("devicemotion", handleMotion, {passive:true});
          window.addEventListener("deviceorientation", handleOrientation, {passive:true});
          calibrate();
          reqBtn.style.display="none";
        }
      }catch(err){ console.error(err); }
    } else {
      window.addEventListener("devicemotion", handleMotion, {passive:true});
      window.addEventListener("deviceorientation", handleOrientation, {passive:true});
      calibrate();
      reqBtn.style.display="none";
    }
  }

  function calibrate(){
    calib.x = g.x;
    calib.y = g.y;
  }

  reqBtn.addEventListener("click", requestPermission);
})();
</script>
</body>
</html>
