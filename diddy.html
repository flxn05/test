<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ball Path Tracker</title>
<style>
  html,body{
    height:100%;
    margin:0;
    background:#000;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .stage{
    position:relative;
    width:100vw;
    height:100vh;
    background:#000;
    overflow:hidden;
  }
  canvas{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
  }
  .ball{
    position:absolute;
    width:80px;
    height:80px;
    border-radius:50%;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    background: radial-gradient(circle at 35% 30%, #ff8080 0%, #ff0000 40%, #7a0000 100%);
    box-shadow:
      0 0 60px rgba(255,80,80,0.9),
      0 0 120px rgba(255,0,0,0.6),
      0 0 200px rgba(255,40,40,0.4);
    will-change: transform;
    pointer-events:none;
  }
  button{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    padding:12px 18px;
    border:none;
    border-radius:12px;
    background:#e00000;
    color:white;
    font-size:16px;
    box-shadow:0 0 20px rgba(255,0,0,0.6);
    z-index:10;
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <canvas id="trail"></canvas>
    <div id="ball" class="ball"></div>
    <button id="reqBtn">Sensor erlauben</button>
  </div>

<script>
(function(){
  const ball = document.getElementById('ball');
  const stage = document.getElementById('stage');
  const reqBtn = document.getElementById('reqBtn');
  const canvas = document.getElementById('trail');
  const ctx = canvas.getContext('2d');

  let width, height, radius = 40;
  function measure(){
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }
  measure(); window.addEventListener('resize', measure);

  let pos = { x: width/2, y: height/2 };
  let g = { x:0, y:0 };   
  let smoothG = { x:0, y:0 };

  let calib = { x:0, y:0 };

  const smoothing = 0.05;
  let lastPos = { x: pos.x, y: pos.y };

  function updateBall(){
    smoothG.x += (g.x - smoothG.x) * smoothing;
    smoothG.y += (g.y - smoothG.y) * smoothing;

    const adjX = smoothG.x - calib.x;
    const adjY = smoothG.y - calib.y;

    pos.x = width/2 + adjX * 25;
    pos.y = height/2 + adjY * 25;

    pos.x = Math.max(radius, Math.min(width-radius, pos.x));
    pos.y = Math.max(radius, Math.min(height-radius, pos.y));

    // Draw path line
    ctx.beginPath();
    ctx.moveTo(lastPos.x, lastPos.y);
    ctx.lineTo(pos.x, pos.y);
    ctx.strokeStyle = "rgba(180,180,180,0.3)";
    ctx.lineWidth = 2;
    ctx.stroke();

    lastPos.x = pos.x;
    lastPos.y = pos.y;

    ball.style.left = pos.x+"px";
    ball.style.top = pos.y+"px";

    requestAnimationFrame(updateBall);
  }
  requestAnimationFrame(updateBall);

  function handleMotion(e){
    const a = e.accelerationIncludingGravity;
    if (a){
      g.x = a.x || 0;
      g.y = -(a.y || 0);
    }
  }
  function handleOrientation(e){
    const beta = e.beta || 0;
    const gamma = e.gamma || 0;
    g.x = Math.sin(gamma * Math.PI/180) * 9.81;
    g.y = -Math.sin(beta * Math.PI/180) * 9.81;
  }

  async function requestPermission(){
    if (stage.requestFullscreen) stage.requestFullscreen();
    if (screen.orientation && screen.orientation.lock){
      try{ await screen.orientation.lock("portrait"); }catch(e){ console.warn("Orientation lock not supported",e); }
    }

    if (typeof DeviceMotionEvent !== "undefined" &&
        typeof DeviceMotionEvent.requestPermission === "function"){
      try{
        const res = await DeviceMotionEvent.requestPermission();
        if (res === "granted"){
          window.addEventListener("devicemotion", handleMotion, {passive:true});
          window.addEventListener("deviceorientation", handleOrientation, {passive:true});
          calibrate();
          reqBtn.style.display="none";
        }
      }catch(err){ console.error(err); }
    } else {
      window.addEventListener("devicemotion", handleMotion, {passive:true});
      window.addEventListener("deviceorientation", handleOrientation, {passive:true});
      calibrate();
      reqBtn.style.display="none";
    }
  }

  function calibrate(){
    calib.x = g.x;
    calib.y = g.y;
  }

  reqBtn.addEventListener("click", requestPermission);
})();
</script>
</body>
</html>
