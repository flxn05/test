<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Roter Ball — Smoothe Gravitation</title>
<style>
  html,body{
    height:100%;
    margin:0;
    background:#0b1020;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .stage{
    position:relative;
    width:90vw;
    height:80vh;
    max-width:600px;
    max-height:800px;
    background:#111827;
    border-radius:18px;
    box-shadow:0 0 20px rgba(0,0,0,0.5) inset;
    overflow:hidden;
  }
  .ball{
    position:absolute;
    width:64px;
    height:64px;
    border-radius:50%;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    background: radial-gradient(circle at 35% 30%, #ff6b6b 0%, #e11 40%, #8b0000 100%);
    box-shadow: 0 0 40px rgba(255,80,80,0.6);
    will-change: transform;
  }
  button{
    position:absolute;
    bottom:10px;
    left:50%;
    transform:translateX(-50%);
    padding:10px 16px;
    border:none;
    border-radius:10px;
    background:#e04848;
    color:white;
    font-size:14px;
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div id="ball" class="ball"></div>
    <button id="reqBtn">Sensor erlauben</button>
  </div>

<script>
(function(){
  const ball = document.getElementById('ball');
  const stage = document.getElementById('stage');
  const reqBtn = document.getElementById('reqBtn');

  let width, height, radius = 32;
  function measure(){
    const rect = stage.getBoundingClientRect();
    width = rect.width;
    height = rect.height;
  }
  measure(); window.addEventListener('resize', measure);

  let pos = { x: width/2, y: height/2 };
  let g = { x:0, y:0 };   // aktuelle Sensorwerte
  let smoothG = { x:0, y:0 }; // geglättete Werte

  const smoothing = 0.05; // kleiner = glatter

  function updateBall(){
    // Low-pass Filter
    smoothG.x += (g.x - smoothG.x) * smoothing;
    smoothG.y += (g.y - smoothG.y) * smoothing;

    // Neue Position abhängig von Gravitation
    pos.x = width/2 + smoothG.x * 20;
    pos.y = height/2 + smoothG.y * 20;

    // Begrenzung an Rändern (kein Bouncing, einfach clamp)
    pos.x = Math.max(radius, Math.min(width-radius, pos.x));
    pos.y = Math.max(radius, Math.min(height-radius, pos.y));

    // Anwenden
    ball.style.left = pos.x+"px";
    ball.style.top = pos.y+"px";

    requestAnimationFrame(updateBall);
  }
  requestAnimationFrame(updateBall);

  function handleMotion(e){
    const a = e.accelerationIncludingGravity;
    if (a){
      g.x = a.x || 0;     // links/rechts
      g.y = -(a.y || 0);  // kippen vor/zurück
    }
  }
  function handleOrientation(e){
    const beta = e.beta || 0;
    const gamma = e.gamma || 0;
    g.x = Math.sin(gamma * Math.PI/180) * 9.81;
    g.y = -Math.sin(beta * Math.PI/180) * 9.81;
  }

  async function requestPermission(){
    if (typeof DeviceMotionEvent !== "undefined" &&
        typeof DeviceMotionEvent.requestPermission === "function"){
      try{
        const res = await DeviceMotionEvent.requestPermission();
        if (res === "granted"){
          window.addEventListener("devicemotion", handleMotion, {passive:true});
          window.addEventListener("deviceorientation", handleOrientation, {passive:true});
        }
      }catch(err){ console.error(err); }
    } else {
      window.addEventListener("devicemotion", handleMotion, {passive:true});
      window.addEventListener("deviceorientation", handleOrientation, {passive:true});
    }
  }

  reqBtn.addEventListener("click", requestPermission);
})();
</script>
</body>
</html>
